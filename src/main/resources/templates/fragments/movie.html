<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
</head>
<body>

<div class="sapchieu" th:fragment="comingHome(comingList)">
  <div class="mt-5 title text">
    <h2 class="mb-0">PHIM SẮP CHIẾU</h2>
  </div>
  <div class="slider-wrapper">
    <div class="slider-buttons text-end">
      <button class="pre slider-button" id="pre-btn-slider"><i class="fa-solid fa-angle-left"></i></button>
      <button class="next slider-button" id="next-btn-slider"><i class="fa-solid fa-angle-right"></i></button>
    </div>
    <div class="slider">

      <div class="images">
        <div th:each="movie, iterStat : ${comingList}" class="item" th:style="'--i: ' + ${iterStat.index}">
          <img th:src="@{${movie.imgPathAtLocal}}" >
        </div>
      </div>
      <div class="content">
        <div th:each="movie, iterStat : ${comingList}" class="item" th:classappend="${iterStat.index == 0} ? 'active'">
          <h3 th:text="${movie.name}"></h3>
          <div class="des">
            <span th:text="${movie.description.length() > 200 ? movie.description.substring(0, movie.description.lastIndexOf(' ', 200)) + '...' : movie.description}"></span>
          </div>
          <a th:href="@{'/movie/' + ${movie.id}}">Xem thêm</a>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="dangchieu" th:fragment="showingByGenre(movieList, genreList)">
  <div class="mt-5 title text">
    <h2 class="mb-0">PHIM ĐANG CHIẾU THEO THỂ LOẠI</h2>
  </div>
  <div class="type-film d-flex align-items-center flex-wrap">
    <button type="button"
            class="btn button-type-film-showing active"
            onclick="handleFetchByGenre(0)">
      Tất cả
    </button>

    <th:block th:each="genre : ${genreList}">
      <button type="button" class="btn button-type-film-showing"
              th:text="${genre.name}"
              th:attr="onclick='handleFetchByGenre(\'' + ${genre.id} + '\')'">
      </button>
    </th:block>
  </div>

  <div class="row-phim">
    <div th:each="item : ${movieList}" class="w-100 d-flex justify-content-center">
      <a class="card" th:href="@{'/movie/' + ${item.id}}">
        <div class="poster">
          <img th:src= "@{${item.imgPathAtLocal}}" alt="poster" />
        </div>
        <div class="detail">
          <h2 class="name-film" th:text="${item.name}"></h2>
          <h3 class="director" th:text="'Đạo diễn ' + ${item.director}"></h3>
          <div class="tags d-flex justify-content-center p-2">
            <!--              <span th:class="${item.name_nhanphim.toLowerCase()}">${item.name_nhanphim}</span>-->
          </div>
        </div>
      </a>
    </div>
  </div>
</div>

<div class="dangchieu" id="showing" th:fragment="showing(showingList)">
  <div class="mt-5 title text">
    <h2 class="mb-0">PHIM ĐANG CHIẾU</h2>
  </div>

  <div class="row-phim">
    <div th:each="item : ${showingList}" class="w-100 d-flex justify-content-center">
      <a class="card" th:href="@{'/movie/' + ${item.id}}">
        <div class="poster">
          <img th:src="@{${item.imgPathAtLocal}}"  alt="poster" />
        </div>
        <div class="detail">
          <h2 class="name-film" th:text="${item.name}"></h2>
          <h3 class="director" th:text="'Đạo diễn ' + ${item.director}"></h3>
          <div class="tags d-flex justify-content-center p-2">
            <!--              <span th:class="${item.name_nhanphim.toLowerCase()}">${item.name_nhanphim}</span>-->
          </div>
        </div>
      </a>
    </div>
  </div>
</div>

<div class="dangchieu" id="coming" th:fragment="coming(comingList)">
  <div class="mt-5 title text">
    <h2 class="mb-0">PHIM SẮP CHIẾU</h2>
  </div>


  <div class="row-phim">
    <div th:each="item : ${comingList}" class="w-100 d-flex justify-content-center">
      <a class="card" th:href="@{'/movie/' + ${item.id}}">
        <div class="poster">
          <img th:src= "@{${item.imgPathAtLocal}}"  alt="poster" />
        </div>
        <div class="detail">
          <h2 class="name-film" th:text="${item.name}"></h2>
          <h3 class="director" th:text="'Đạo diễn ' + ${item.director}"></h3>
        </div>
      </a>
    </div>
  </div>
</div>

<th:block th:fragment = "detail(movie)" >
    <div class="d-flex justify-content-md-between flex-column flex-md-row align-items-center">
      <div id="videoModal" class="modal-detail">
        <div class="modal-detail-content">
          <iframe id="videoPlayer" width="100%" height="600px" src="" frameborder="0" allowfullscreen="true"></iframe>
        </div>
      </div>
      <div class="card-movie overflow-hidden me-5" >
        <img th:src= "@{${movie.imgPathAtLocal}}"  alt="" class="w-100 h-100">
        <div class="play-button" th:attr="onclick='showTrailer(\'' + ${movie.trailerPath} + '\')'"><i class="fa-solid fa-play"></i></div>
      </div>
      <div class="card-detail-movie">
        <h3 th:text = "${movie.name}"></h3>
        <p>Khởi chiếu: <span th:text="${movie.releaseDate}"></span></p>
        <p>Thể loại: <span th:text="${genre}"></span></p>
        <p>Diễn viên: <span th:text="${movie.actors}"></span></p>
        <p>Đạo diễn: <span th:text="${movie.director}"></span></p>
        <p>Mô tả phim: <span th:text="${movie.description}"></span></p>
      </div>
    </div>
    <div class="mt-5">
      <div class="booking-ticket d-flex justify-content-center align-items-center">
        <div class="days-available d-flex">
            <script>
              var daysAvailable = document.querySelector(".days-available");

              // Lấy ngày và thứ hiện tại
              var currentDate = new Date();
              var currentDay = currentDate.getDate();
              var currentMonth = currentDate.getMonth() + 1; // Tháng bắt đầu từ 0
              var currentYear = currentDate.getFullYear();
              var currentWeekday = currentDate.getDay(); // 0 là Chủ Nhật, 1 là Thứ 2, ...

              // Tạo 6 ngày kế tiếp
              for (var i = 0; i <= 5; i++) {
                  // Tính toán ngày tiếp theo
                  var nextDate = new Date(currentYear, currentMonth - 1, currentDay + i);
                  var nextDay = nextDate.getDate();
                  var nextMonth = nextDate.getMonth() + 1;
                  var nextYear = nextDate.getFullYear();
                  var nextWeekday = nextDate.getDay();

                  // Tạo div ngày mới
                  var newDay = document.createElement("div");
                  if(i == 0) {
                      newDay.style="border-top-left-radius: 12px; border-bottom-left-radius: 12px;"
                  }
                  newDay.className = "days";
                  newDay.setAttribute("data-date", nextYear + "-" + nextMonth + "-" + nextDay);
                  var dateSpan = document.createElement("span");
                  dateSpan.textContent = nextDay + "/" + nextMonth;
                  dateSpan.id = "day" + (i + 1);
                  var weekdaySpan = document.createElement("span");
                  var weekdays = ["CN", "Th 2", "Th 3", "Th 4", "Th 5", "Th 6", "Th 7"];
                  weekdaySpan.textContent = weekdays[nextWeekday];
                  weekdaySpan.id = "weekday" + (i + 1);

                  newDay.appendChild(dateSpan);
                  newDay.appendChild(weekdaySpan);
                  daysAvailable.appendChild(newDay);
              }
            </script>

        </div>
      </div>
      <div class="my-3 d-flex justify-content-center">
        <div class="list-group list-group-flush">
        </div>
      </div>
    </div>


</th:block>


<!--ADMIN-->
<div class="dangchieu" id="all-movie" th:fragment="all_movie">
  <div class="mt-5 title text">
    <h2 class="mb-0">DANH SÁCH PHIM</h2>
  </div>

  <div>
    <a th:href="@{/admin/deleted-movie}" class="btn btn-success mb-3">Phim đã xóa</a>
  </div>

  <div>
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#movieModal">
      <i class="fa-solid fa-plus"></i>
      Thêm phim
    </button>
  </div>

  <div class="row-phim">
    <div th:each="item : ${movieList}" class="w-100 d-flex justify-content-center box" style="position: relative">

      <a class="card" th:href="@{'/admin/movie/' + ${item.id}}">

        <div class="poster">
          <img th:src= "@{${item.imgPathAtLocal}}"  alt="poster" />
        </div>
        <div class="detail">
          <h2 class="name-film" th:text="${item.name}"></h2>
          <h3 class="director" th:text="'Đạo diễn ' + ${item.director}"></h3>
          <div class="tags d-flex justify-content-center p-2">
            <!--              <span th:class="${item.name_nhanphim.toLowerCase()}">${item.name_nhanphim}</span>-->
          </div>
        </div>

      </a>
      <div style="position: absolute; top: 10px; right: 20px" class="d-flex align-items-center">
        <input class="form-check-input me-2" type="checkbox" value=""
               style="height: 32px; width: 32px; margin-top: 0 !important;"
               th:attr="data-id=${item.id},data-name=${item.name}">
        <button type="button" class="btn btn-danger delete-movie-btn"
                style="height: 32px"
                data-bs-toggle="modal"
                data-bs-target="#deleteMovieModal1"
                th:attr="data-id=${item.id}, data-name=${item.name}"
        ><i class="fa-solid fa-trash"></i></button>
      </div>

    </div>
  </div>

  <!-- Modal Xóa phim -->
  <div class="modal fade" id="deleteMovieModal1" tabindex="-1" aria-labelledby="deleteMovieModalLabel1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="deleteMovieModalLabel1">Xóa phim</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div>Bạn có chắc là muốn xóa <span id="deleteMovieName"></span></div>
        </div>
        <div class="modal-footer">
<!--          <form action="" th:method="delete" id="deleteMovieForm">-->
<!--            <button type="submit" class="btn btn-danger" id="deleteMovieBtn">Xóa</button>-->
<!--          </form>-->
          <button type="button" class="btn btn-danger" id="deleteMovieBtn">Xóa</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Hủy</button>
        </div>
      </div>
    </div>
  </div>
</div>


<!--Chi tiết phim admin-->
<div th:fragment = "admin_detail" class="d-flex justify-content-md-between flex-column flex-md-row align-items-center">
  <div id="videoModalAdmin" class="modal-detail">
    <div class="modal-detail-content">
      <iframe id="videoPlayerAdmin" width="100%" height="600px" src="" frameborder="0" allowfullscreen="true"></iframe>
    </div>
  </div>
  <div class="card-movie overflow-hidden me-5" >
    <img th:src= "@{${movie.imgPathAtLocal}}"  alt="" class="w-100 h-100">
    <div class="play-button" th:attr="onclick='showTrailer(\'' + ${movie.trailerPath} + '\')'"><i class="fa-solid fa-play"></i></div>
  </div>
  <div class="card-detail-movie">
    <div class="detail-movie">
      <h3 th:text = "${movie.name}"></h3>
      <p>Khởi chiếu: <span th:text="${movie.releaseDate}"></span></p>
      <p>Thể loại: <span th:text="${genre}"></span></p>
      <p>Diễn viên: <span th:text="${movie.actors}"></span></p>
      <p>Đạo diễn: <span th:text="${movie.director}"></span></p>
      <p>Mô tả phim: <span th:text="${movie.description}"></span></p>
    </div>

    <button id="updateMovieBtn" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#movieModal"
            th:attr="data-id=${movie.id}"
    >
      <i class="fa-solid fa-pen-to-square"></i>
      Sửa thông tin
    </button>
    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteMovieModal">
      <i class="fa-solid fa-trash"></i>
      Xóa phim
    </button>
  </div>

  <!-- Modal Xóa phim -->
  <div class="modal fade" id="deleteMovieModal" tabindex="-1" aria-labelledby="deleteMovieModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="deleteMovieModalLabel">Xóa phim</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div>Bạn có chắc là muốn xóa <span th:text="${movie.name}"></span></div>
        </div>
        <div class="modal-footer">
          <form th:action="@{'/admin/movie/'+${movie.id}}" th:method="delete">
            <input type="submit" class="btn btn-danger" value="Xóa"></input>
          </form>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Hủy</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Suất chiếu  -->
<div></div>


<!--Form edit movie-->
<!-- Modal -->
<div th:fragment = "movie_modal" class="modal fade" id="movieModal" tabindex="-1" role="dialog" aria-labelledby="movieModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
    <div class="modal-content">
<!--      <form th:action="@{/admin/movie}" th:object="${movieDTO}" method="post" enctype="multipart/form-data">-->
<!--      <form th:action="@{${formAction}}" th:object="${movie}" th:method="${formMethod}" enctype="multipart/form-data">-->
      <form id="movieForm" th:object="${movie}" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title" id="movieModalLongTitle">Thêm phim</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body bg-secondary bg-gradient">

              <div class="container">
                <div class="row">
                  <div class="mb-3 col-md-6">
                    <label for="movie-name" class="form-label text-white">Tên phim</label>
                    <input type="text" class="form-control" id="movie-name" required th:field="*{name}">
                  </div>

                  <div class="mb-3 col-md-6">
                    <label for="movie-director" class="form-label text-white">Đạo diễn</label>
                    <input type="text" class="form-control" id="movie-director" th:field="*{director}" required>
                  </div>

                  <div class="input-group mb-3 col-md-12">
                    <span class="input-group-text">Diễn viên</span>
                    <input type="text" class="form-control" id="movie-actors" th:field="*{actors}" required>
                  </div>

                  <div class="mb-3 col-md-3">
                    <div class="mb-2">
                      <label for="movie-release-day" class="form-label text-white mb-3">Ngày chiếu</label>
                      <input type="date" class="form-control" id="movie-release-day" th:field="*{releaseDate}" required>
                    </div>

                    <div class="">
                      <label for="movie-duration" class="form-label text-white">Thời lượng (phút)</label>
                      <input type="number" class="form-control" id="movie-duration" th:field="*{duration}" required>
                    </div>
                  </div>

                  <div class="mb-3 col-md-3">
                      <label for="movie-coming" class="form-label text-white">Sắp chiếu</label>
                      <input class="form-check-input" id="movie-coming" type="checkbox" th:field="*{coming}">
                  </div>

                  <div  class="mb-3 col-md-6">
                    <div class="mb-1">
                      <label for="movie-image" class="form-label text-white">Poster</label>
                      <input class="form-control" type="file" id="movie-image" accept="image/png, image/jpeg, image/jpg"
                             name="image"
                             th:required="${imageRequired}"
                      >
                    </div>

                    <div>
                      <img th:if="${not #strings.isEmpty(movie.imgPathAtLocal)}" th:src="@{${movie.imgPathAtLocal}}"  alt="poster" th:class="img-fluid" />
                    </div>
                  </div>


                  <div class="mb-3 col-md-6">
                    <span class="input-group-text">Link trailer</span>
                    <input type="text" id="movie-trailer-path" class="form-control" th:field="*{trailerPath}" required>
                  </div>

                    <div class="form-floating mb-3">
                        <textarea class="form-control" id="movie-description" style="height: 100px" th:field="*{description}"></textarea>
                        <label for="movie-description">Mô tả</label>
                    </div>

                  <label class="form-label text-white">Nhãn phim</label>
                  <div class="btn-group mb-3" role="group">
                    <div th:each="tagMovie : ${tagMovieList}">
                      <input class="btn-check" type="radio" name="tagMovie" th:id="@{'radio-'+${tagMovie.id}}"
                             th:value="${tagMovie.id}"
                             th:field="*{tagId}">
                      <label class="btn btn-outline-light" th:for="@{'radio-'+${tagMovie.id}}"
                             th:text="${tagMovie.name}"
                      ></label>
                    </div>
                  </div>

                  <label class="form-label text-white">Thể loại</label>
                  <div class="btn-group mb-3">
                    <div th:each="genre : ${genreList}">
                      <input type="checkbox" class="btn-check" th:id="@{'checkbox-'+${genre.id}}" autocomplete="off"
                             name="genre"
                             th:value="${genre.name}"
                             th:checked="${movie.genres != null && movie.genres.contains(genre.name)}"
                      >
                      <label class="btn btn-outline-light" th:for="@{'checkbox-'+${genre.id}}" th:text="${genre.name}"></label>
                    </div>
                  </div>
                </div>

              </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          <button type="reset" class="btn btn-secondary">Reset</button>
          <button type="button" class="btn btn-primary mr-3" id="movieSubmitBtn" th:text="${btn}"></button>
        </div>
      </form>
    </div>
  </div>
</div>


<!--Danh sach phim da xoa-->
<div class="dangchieu" id="all-movie-deleted" th:fragment="all_movie_deleted">
  <div class="mt-5 title text">
    <h2 class="mb-0">DANH SÁCH PHIM</h2>
  </div>

  <div>
    <a th:href="@{/admin/movie}" class="btn btn-success mb-3">Danh sách phim</a>
  </div>

  <div class="row-phim">
    <div th:each="item : ${movieList}" class="w-100 d-flex justify-content-center box" style="position: relative">

      <a class="card" th:href="@{'/admin/movie/' + ${item.id}}">

        <div class="poster">
          <img th:src= "@{${item.imgPathAtLocal}}"  alt="poster" />
        </div>
        <div class="detail">
          <h2 class="name-film" th:text="${item.name}"></h2>
          <h3 class="director" th:text="'Đạo diễn ' + ${item.director}"></h3>
          <div class="tags d-flex justify-content-center p-2">
            <!--              <span th:class="${item.name_nhanphim.toLowerCase()}">${item.name_nhanphim}</span>-->
          </div>
        </div>

      </a>
      <div style="position: absolute; top: 10px; right: 20px" class="d-flex align-items-center">
        <input class="form-check-input me-2" type="checkbox" value=""
               style="height: 32px; width: 32px; margin-top: 0 !important;"
               th:attr="data-id=${item.id},data-name=${item.name}">
        <button type="button" class="btn btn-success restore-movie-btn"
                style="height: 32px"
                th:attr="data-id=${item.id}, data-name=${item.name}"
        ><i class="fa-solid fa-trash-can-arrow-up"></i></button>
      </div>

    </div>
  </div>
</div>
<!--Danh sach phim da xoa end-->

    <script>
      function handleBooking(elem) {
          // let name = $($(elem).closest(".wrapper-suatchieu").find(".title-theater")).text();
          let time = $(elem).text();
          let type = $($(elem).parent().parent().find(".film")).text();
          let date = $($(elem).closest(".cls").find("h3")).text();
          let room = $(elem).data("room");
          let id_showtime = $(elem).data("showtime");
          window.location.href = `<?php echo _WEB_ROOT ?>/booking/index/${time}/${type}/${date}/${id_showtime}/${room}`;
      }
	</script>
<!--    -->
<!--		if (!empty($suatchieu))-->
<!--			foreach ($suatchieu as $rap => $dates) {-->
<!--    echo "<div class='wrapper-suatchieu'>";-->
<!--    echo "<div class='title-theater text' style='width:fit-content;padding: 15px; border-radius: 10px;'>$rap</div>";-->
<!--    foreach ($dates as $date => $loaives) {-->
<!--    $date = date('d-m', strtotime($date));-->
<!--    echo "<div class='mt-4 cls'>-->
<!--      <h3 class='text date-choose'>$date</h3>";-->
<!--      foreach ($loaives as $loaive => $times) {-->
<!--      $tagspan = strtolower($loaive);-->
<!--      echo "<div class='my-4'>";-->
<!--      echo "<div class='film film-$tagspan' style='font-size: 1.2rem; margin-right: 20px'>$loaive</div>";-->
<!--      echo "<div style='display: flex; flex-wrap: wrap; align-items: center; row-gap: 20px'>";-->
<!--        foreach ($times as $time) {-->
<!--        $tg = $time[0];-->
<!--        $phong = $time[1];-->
<!--        $id_suatchieu = $time[2];-->
<!--        echo "<button class='btn btn-showtime' data-room='$phong' data-showtime='$id_suatchieu' onclick='handleBooking(this)'>-->
<!--          $tg-->
<!--        </button>";-->
<!--        }-->
<!--        echo "</div></div>";-->
<!--      }-->
<!--      echo "</div>";-->
<!--    }-->
<!--    echo "</div>";-->
<!--    }-->


  </div>
</div>
</body>
</html>