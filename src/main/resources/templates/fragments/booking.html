<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
</head>
<body>
<th:block th:fragment="chooseSeat(infoMovie, tagName, genre)">
    <div class="steps d-flex justify-content-md-end justify-content-between container">
        <p class="step active">
            <span>01</span> CHỌN GHẾ
        </p>
        <p class="step">
            <span>02</span> CHỌN BẮP NƯỚC VÀ THANH TOÁN
        </p>
    </div>
    <div class="container d-flex justify-content-between">
        <div class="chonkhunggiovaghe position-relative">
            <div class="time">
                <div class="grid-container">
                    <h3 th:text="${infoMovie.name}"></h3>
                    <div class="time-and-type d-flex flex-md-row align-items-center justify-content-center">
                        <div class="time-duration-phim d-flex justify-content-center align-items-center me-3">
                            <i class="fa-solid fa-clock" style="font-size: 1.5rem; margin-right: 10px;"></i>
                            <span class="time-minutes" style="font-size: 1.1rem;" ><th:block th:text="${infoMovie.duration}"></th:block> phút</span>
                        </div>
                        <div class="type-phim-btn d-flex justify-content-center align-items-center" style="font-size: 1.1rem;" th:text="${tagName}"></div>
                    </div>
                    <div class="khunggio">
                        <p class="pb-2 text-center" style="font-size: 1.2rem;">Ngày chiếu: <th:block th:text="${infoMovie.releaseDate}"></th:block></p>
                    </div>
                    <div class="showtime">
                        <p class="pb-2 text-center" style="font-size: 1.2rem;"><span style="margin-right:20px;">Loại vé: </span> <span>Giờ chiếu: ></span></p>
                    </div>
                </div>
            </div>

            <!-- Màn hình và ghế -->
            <div class="screen-and-seat position-relative">
                <div class="screen w-100 my-md-5 position-relative"
                     style="height: 80px;">
                    <img th:src="@{/public/others/screen.png}" alt="" style="width: 100%; height: 100%; object-fit: contain">
                </div>

                <div class="seats container-fluid">
                    <script th:inline="javascript">
                        function intToChar(num) {
                            return String.fromCharCode('A'.charCodeAt(0) + num);
                        }

                        let row = 0;
                        const seats = /*[[${seats}]]*/;
                        let htmls = ``;
                        $.each(seats, function(index, item) {
                            let id = item.id;
                            let vitri = index % 14 + 1;
                            let trangthai = (item.sold === true) ? "sold" : "";
                            console.log(item);

                            if (vitri == 1) { // Vị trí = 0 báo hiệu bắt đầu hàng mới
                                htmls += "<div class='row-seat mt-2'>";
                                var charRow = intToChar(row);
                                htmls += "<div class='col-seat-name' style='width: 30px; cursor: default;'><span class='text w-100 h-100 d-flex justify-content-center align-items-center'>" + charRow + "</span></div>";
                                htmls += `<div class='col-seat'><div class='seat w-100 ${trangthai}' data-pos='${index}' data-ghe='${id}' style='padding-bottom: 100%' choose='false'></div></div>`;
                            } else if (vitri == 4 || vitri == 10) {
                                htmls += `<div class='col-seat'><div class='seat w-100 ${trangthai}' data-pos='${index}' data-ghe='${id}' style='padding-bottom: 100%' choose='false'></div></div>`;
                                htmls += "<div class='col-seat'></div>";
                            } else if (vitri == 14) {
                                htmls += `<div class='col-seat'><div class='seat w-100 ${trangthai}' data-pos='${index}' data-ghe='${id}' style='padding-bottom: 100%' choose='false'></div></div>`;
                                var charRow = intToChar(row);
                                htmls += "<div class='col-seat-name' style='width: 30px; cursor: default;'><span class='text w-100 h-100 d-flex justify-content-center align-items-center'>" + charRow + "</span></div>";
                                row++;
                                htmls += "</div>";
                            } else {
                                htmls += `<div class='col-seat'><div class='seat w-100 ${trangthai}' data-pos='${index}' data-ghe='${id}' style='padding-bottom: 100%' choose='false'></div></div>`;
                            }
                        });
                        $(".seats").append(htmls);
                    </script>
                </div>

                <div class="desc-seat w-100 d-flex justify-content-around justify-content-md-center mt-5 position-relative">
                    <div class="choosing-desc-seat d-flex justify-content-center align-items-center me-md-5" style="cursor: default !important;">
                        <div class="col-seat me-3">
                            <div class="w-100" style="background-color: #FF6A6A;padding-bottom: 100%; margin-right: 10px; cursor: default;border-radius: 5px;cursor: pointer;"></div>
                        </div>
                        <span class="text">Đang chọn</span>
                    </div>
                    <div class="booking-desc-seat d-flex justify-content-center align-items-center me-md-5" style="cursor: default !important;">
                        <div class="col-seat me-3">
                            <div class="w-100" style="padding-bottom: 100%; margin-right: 10px; cursor: default;background-color: #B5B5B5;border-radius: 5px;cursor: pointer;"></div>
                        </div>
                        <span class="text">Ghế đơn</span>
                    </div>
                    <div class="sold-desc-seat d-flex justify-content-center align-items-center me-md-5" style="cursor: default !important;">
                        <div class="col-seat me-3">
                            <div class="w-100" style="background-color: #695CFE;padding-bottom: 100%; margin-right: 10px; cursor: default;border-radius: 5px;cursor: pointer;"></div>
                        </div>
                        <span class="text">Đã bán</span>
                    </div>
                </div>
            </div>
            <script>
			function intToChar(num) {
				const code = 'A'.charCodeAt(0);
				return String.fromCharCode(code + num);
			}

			function handleChonGhe() {
				let gheDaChon = [];
				$(".seat.choosing").each(function() {
					let row = $(this).attr("data-row");
					let pos = $(this).attr("data-pos");
                    var url = new URL(window.location.href);
                    var idRoom = url.searchParams.get("id");
                    var showtime = url.searchParams.get("showtime");
					gheDaChon.push({
						"idRoom": idRoom,
						"idShowtime": showtime,
					});
				})
				if (gheDaChon.length > 0) {
					// Gửi dữ liệu qua cho trang chọn bắp nước
					sessionStorage.setItem("gheDaChon", JSON.stringify(gheDaChon));
                    const dynamicPath = /*[[@{/booking/chooseFood}]]*/ '';
					window.location.href = dynamicPath;
				} else {
                    Toastify({
                        text: "Vui lòng chọn ghế!",
                        duration: 3000,
                        gravity: "top",
                        position: "right",
                        style: {
                            background: "linear-gradient(to top, #ff0844 0%, #ffb199 100%)"
                        },
                    }).showToast();
				}
			}
		</script>
            <div class="next-step d-flex justify-content-center align-items-center" style="cursor: pointer;" onclick="handleChonGhe()">
                <i class="fa-solid fa-arrow-right" style="color: white; font-size: 1.2rem;"></i>
            </div>
        </div>

    </div>
</th:block>

</body>
</html>